

## 流量分析

VDI 的流量类型：

| 流量类型               | 具体描述                                                     |
| ---------------------- | ------------------------------------------------------------ |
| 桌面图像变化产生的流量 | 鼠标移动、界面切换、页面翻滚等只要存在图像变化的地方都会产生流量 |
| 视频重定向             | 本地视频和Flash视频，传输速率与音视频码率一致（流量与在PC看网上电影差不多） |
| 外设重定向             | 打印机、扫描仪、U盘、摄像头等外设，其流量大小取决于拷贝/打印文件的大小、图像分辨率的大小（摄像头流量一般会经过压缩、U盘拷贝速度当前为2~3M/s） |

面图像流量分析

| 场景描述      | 平均流量                            | 流量上限 |
| ------------- | ----------------------------------- | -------- |
| 办公/上网环境 | 0.66MB/s（峰值场景，正常为200KB/s） | 1.18MB/s |

a）流量大小与以下信息有关：

- 图像变化快慢、复杂程度
- 桌面分辨率
- 客户端设置的帧率（一般介于20~25）
- 压缩算法（如：MD、JPEG、GLZ）

b）视频重定向流量分析

| 场景描述 | 码率     | 平均流量 |
| -------- | -------- | -------- |
| 720P     | 4.9Mbps  | 0.68MB/s |
| 1080P    | 14.4Mbps | 2.12MB/s |
| 某公司   | 720P     | 0.2MB/s  |

流量大小与视频码率有关

（源文件重定向，无压缩）

USB外设重定向数据流量分析

| **场景描述**  | **图像分辨率/****帧率** | **平均流量** |
| ------------- | ----------------------- | ------------ |
| U盘           | 无                      | 2.48MB/s     |
| 移动硬盘      | 无                      | 4.38MB/s     |
| 摄像头/高拍仪 | 800*600/8FPS            | 0.46MB/s     |

c）流量大小与以下几个信息有关：

- U盘/移动硬件读写速率
- 摄像头/高拍仪跟分辨率和帧率有关
- 压缩算法（JPEG）

## 互联网带宽

根据个人经验，一般每人 2Mb=0.25MB 带宽，是合理的。也可以利用某公司瘦客户机自带的【网络监测工具】实际测试下，注意，除了考虑开机耗费带宽资源，还要保证正常应用的访问速度

## 局域网交换机

建议采用千兆交换机，实际用户体验更佳

现在千兆二层交换机价格也不贵的

交换机选型除了参考背板带宽外，还需要关注下包转发率

### 服务器选型

重点关注，CPU、内存、IOPS、硬盘

影响 CPU 性能的因素：主频、核心数、线程数，性能 = 主频核心数 1.2（超线程下提升 20%）

内存这个问题没什么好说了，根据个人办公需求来选择，需要注意虚拟化平台默认占用近 8G 内存；服务器配置总内存为 64G，除去平台占用 8G 外，其余虚机可共享内存为 56G。如果每员工分配 4G 内存，且每人均能把内存跑满，可同时允许 14 台虚机同时运行

桌面虚拟化下的内存为共享动态调整模式，并非分配给某虚拟机 4G 内存，它开机后就完全占用了 4G，实际虚机运行过程中，根据个人工作量情况，内存会动态调整，最高为 4G

IOPS

正常来讲，在桌面虚拟化环境下普通办公，如果服务器配置了有SSD固态硬盘，基本不用考虑IOPS了，完全够用。如果采用的是无 SSD 硬盘的服务器，那需要关注下下面的内容了。

| 参数           | 具体描述                                       | 数量值                                                       |
| -------------- | ---------------------------------------------- | ------------------------------------------------------------ |
| 磁盘IOPS       | 磁盘IOPS影响数据读写速度                       | 7.2K-SATA：80IOPS 10K-SAS/FC：150IOPS 15K-SAS/FC：180IOPS SSD：最低2500IOPS |
| 读/写比例      | IOPS分为读和写，一般桌面的读写比例为2：1       | 读写比例2：1                                                 |
| 桌面各阶段IOPS | 每个桌面在不同工作阶段对存储的IOPS要求是不同的 | 开机：26IOPS 登录/退出：12IOPS 工作：10IOPS 不活动：4IOPS    |

如何计算IOPS？

| RAID类型      | 计算公式                            |
| ------------- | ----------------------------------- |
| RAID5、RAID3  | Drive IOPS=Read IOPS + 4*Write IOPS |
| RAID6         | Drive IOPS=Read IOPS + 6*Write IOPS |
| RAID1、RAID10 | Drive IOPS=Read IOPS + 2*Write IOPS |

## 参考文档

- <https://bbs.sangfor.com.cn/forum.php?mod=viewthread&tid=21813>