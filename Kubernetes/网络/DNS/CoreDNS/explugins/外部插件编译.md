切换到稳定分支

```bash
git checkout v1.10.1
```

修改插件列表 `plugin.cfg`

```ini
k8s_event:github.com/coredns/k8s_event
kubeapi:github.com/coredns/kubeapi
```

参考每个插件的 home 页面中的 `Enable With` 进行配置，例如：<https://coredns.io/explugins/k8s_event/>

构建文件

````bash
docker run \
    --rm \
    -it \
    -v $PWD:/v \
    -w /v \
    -e GOPROXY="https://goproxy.cn,direct" \
    golang:1.18 make
````

构建镜像

```bash
[[ ! -d build/docker/amd64 ]] && mkdir -p build/docker/amd64
cp -rpf coredns build/docker/amd64/
cp -rpf Dockerfile build/docker/amd64/

make -f ./Makefile.docker \
    docker-build \
    DOCKER=harbor.local.liaosirui.com:5000/custom NAME=coredns-k8s_event LINUX_ARCH=amd64 VERSION=1.10.1.patch01
```

这里使用 buildx 因此构建命令改为

```bash
ifeq ($(DOCKER),)
	$(error "Please specify Docker registry to use. Use DOCKER=coredns for releases")
else
	docker version
	for arch in $(LINUX_ARCH); do \
-	    DOCKER_BUILDKIT=1 docker build --platform=$${arch} -t $(DOCKER_IMAGE_NAME):$${arch}-$(VERSION) build/docker/$${arch} ;\
+	    docker buildx build --platform=$${arch} -t $(DOCKER_IMAGE_NAME):$${arch}-$(VERSION) build/docker/$${arch} ;\
	done
endif
```

