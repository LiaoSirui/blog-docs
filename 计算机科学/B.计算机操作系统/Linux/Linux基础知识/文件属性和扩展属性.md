## 文件基本属性

Linux 系统是一种典型的多用户系统，不同的用户处于不同的地位，拥有不同的权限。

为了保护系统的安全性，Linux 系统对不同的用户访问同一文件（包括目录文件）的权限做了不同的规定。

在 Linux 中通常使用以下两个命令来修改文件或目录的所属用户与权限：

- chown (change owner) ： 修改所属用户与组。
- chmod (change mode) ： 修改用户的权限。

### 文件的属性

在 Linux 中第一个字符代表这个文件是目录、文件或链接文件等等。

接下来的字符中，以三个为一组，且均为 **rwx** 的三个参数的组合。其中， **r** 代表可读(read)、 **w** 代表可写(write)、 **x** 代表可执行(execute)。 要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号 **-** 而已。

![img](.assets/file-llls22.jpg)

每个文件的属性由左边第一部分的 10 个字符来确定（如下图）。

![img](.assets/363003_1227493859FdXT.png)

从左至右用 0-9 这些数字来表示。

- 第 0 位确定文件类型
- 第 1-3 位确定属主（该文件的所有者）拥有该文件的权限
- 第 4-6 位确定属组（所有者的同组用户）拥有该文件的权限
- 第 7-9 位确定其他用户拥有该文件的权限。

其中

- 第 1、4、7 位表示读权限，如果用 r 字符表示，则有读权限，如果用 - 字符表示，则没有读权限
- 第 2、5、8 位表示写权限，如果用 w 字符表示，则有写权限，如果用 - 字符表示没有写权限
- 第 3、6、9 位表示可执行权限，如果用 x 字符表示，则有执行权限，如果用 - 字符表示，则没有执行权限

#### Chmod 更改文件 9 个属性

文件的权限字符为： `-rwxrwxrwx` ， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：

- r:4
- w:2
- x:1

每种身份(owner/group/others)各自的三个权限(r/w/x)分数是需要累加的，例如当权限为： `-rwxrwx---`分数则是：

- owner = rwx = 4+2+1 = 7
- group = rwx = 4+2+1 = 7
- others= --- = 0+0+0 = 0

九个权限分别是：

- user：用户
- group：组
- others：其他

那么我们就可以使用 u, g, o 来代表三种身份的权限。

此外， a 则代表 all，即全部的身份。

读写的权限可以写成 r, w, x，也就是可以使用下表的方式来看：

![image-20230227163359947](.assets/image-20230227163359947.png)

因此

```bash
 chmod u=rwx,g=rx,o=r test
```

### 文件属主和属组

#### chgrp 更改文件属组

#### chown 更改文件属主和属组

## 文件扩展属性

有时候可能发现作为 root 居然无法对一些文件进行编辑或删除，除了系统中可能部署了一些防篡改的程序造成外，大部分情况是用 chattr 命令配置了该文件的一些扩展属性造成的

`chattr` 其中一些功能是由 Linux 内核版本来支持的，不过现在生产环境使用的 Linux kerne l版本应该都在 2.6 以上了。通过 `chattr` 命令修改文件系统属性能够提高系统的安全性，但是它并不适合所有的目录：`chattr` 命令不能保护 `/`、`/dev`、`/tmp`、`/var` 目录

lsattr命令是用来查看文件扩展属性的

### chattr

 `chattr` 命令用于改变文件属性。

这项指令可改变存放在文件系统上的文件或目录属性，这些属性共有以下模式：

- `A` ：文件或目录的 atime (access time) 不可被修改 (modified)，可以有效预防例如电脑磁盘 I/O 错误的发生
- `j` ：即 journal，设定此参数使得当通过 `mount` 参数：`data=ordered` 或者 `data=writeback` 挂载的文件系统，文件在写入时会先被记录(在 journal 中)。如果 filesystem 被设定参数为 `data=journal`，则该参数自动失效。
- `a`（让文件或目录仅供附加用途）：即 append，设定该参数后，只能向文件中添加数据，而不能删除，多用于服务器日志文件安全，只有 root 才能设定这个属性
- `b`（不更新文件或目录的最后存取时间）：
- `c`（将文件或目录压缩后存放）：即compresse，设定文件是否经压缩后再存储。读取时需要经过自动解压操作
- `d`（将文件或目录排除在倾倒操作之外）：即 no dump，设定文件不能成为 dump 程序的备份目标
- `i`（不得任意更动文件或目录）：设定文件不能被删除、改名、设定链接关系，同时不能写入或新增内容。i 参数对于文件 系统的安全设置有很大帮助
- `s`（保密性删除文件或目录）：保密性地删除文件或目录，即硬盘空间被全部收回
- `S`（即时更新文件或目录）：硬盘 I/O 同步选项，功能类似 sync
- `u`（预防意外删除）：与s相反，当设定为u时，数据内容其实还存在磁盘中，可以用于undeletion

语法

```bash
chattr [-RV][-v<版本编号>][+/-/=<属性>][文件或目录...]
```

参数

- `-R` 递归处理，将指定目录下的所有文件及子目录一并处理
- `-v<版本编号>` 设置文件或目录版本
- `-V` 显示指令执行过程

mode 部分

- `+` ：在原有参数设定基础上，追加参数
- `-` ：在原有参数设定基础上，移除参数
- `=` ：更新为指定参数设定

### lsattr

用 `chattr` 执行改变文件或目录的属性，可执行 `lsattr` 指令查询其属性